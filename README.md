#### **1. Контекст и цель критерия**

Мы анализируем **нелинейную систему** стандартного вида с обратной связью:
*   **Линейная часть (ЛЧ):** описывается передаточной функцией `W(s)` и является устойчивой (или нейтральной).
*   **Нелинейный элемент (НЭ):** описывается статической нелинейностью `φ(y)`, которая заключена в **секторе [0, k]**.
Это означает, что нелинейность удовлетворяет условию:
`0 ≤ φ(y) * y ≤ k * y²` для всех `y`.
График функции `φ(y)` лежит в "коридоре" между прямой `0` и прямой `k*y`.

**Цель критерия Попова:** проверить, является ли система **абсолютно устойчивой** в заданном секторе. То есть, будет ли система устойчива для *любой* конкретной нелинейности `φ(y)`, удовлетворяющей этому секторному условию.

#### **2. Формулировка критерия (по Киму)**

Пусть линейная часть системы **строго устойчива** (все полюса `W(s)` находятся строго в левой полуплоскости). Тогда для абсолютной устойчивости системы в секторе `[0, k]` **достаточно**, чтобы существовало такое действительное число `q`, при котором для всех `ω ≥ 0` выполняется неравенство:

**`Re( (1 + jωq) * W(jω) ) + ¹⁄ₖ > 0`**

**Пояснение элементов формулы:**
*   `W(jω)` — частотная характеристика (амплитудно-фазовая характеристика, АФХ) линейной части.
*   `k` — верхняя граница сектора нелинейности.
*   `q` — произвольный вещественный параметр, который мы можем подбирать для облегчения выполнения условия.
*   `(1 + jωq) * W(jω)` — так называемая **модифицированная частотная характеристика Попова**.

#### **3. Геометрическая интерпретация (Годограф Попова)**

Условие можно переформулировать геометрически. Построим на комплексной плоскости **годограф Попова**:
`G(ω) = U(ω) + jV(ω) = X(ω) + jY(ω)`, где
*   `X(ω) = Re(W(jω))`
*   `Y(ω) = ω * Im(W(jω))` (обратите внимание на множитель `ω`!)

**Условие устойчивости:** Найти такую прямую (***прямая Попова***), проходящую через точку `(-¹⁄ₖ, j0)` с угловым коэффициентом `1/q`, что годограф Попова `G(ω)` лежит **справа** от этой прямой.

**Алгоритм геометрической проверки:**
1.  Постройте годограф Попова `G(ω)`.
2.  Проведите через точку `(-¹⁄ₖ, j0)` прямую так, чтобы весь годограф находился справа от нее.
3.  Если такая прямая существует — система абсолютно устойчива.

#### **4. Практический алгоритм проверки на Python (на примере из Кима)**

Рассмотрим систему из задачника Кима. Пусть линейная часть имеет передаточную функцию:
`W(s) = 1 / ( (s+1)(s² + s + 1) )`
Нелинейность находится в секторе `[0, k=2]`.

**Шаг 1: Зададим параметры и частотный диапазон**
```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import signal

# Параметры анализа
k = 2.0  # Верхняя граница сектора
q = 0.8  # Параметр Попова (подбирается для выполнения условия)
omega = np.logspace(-2, 2, 1000)  # Частоты в логарифмической шкале (от 0.01 до 100)
```

**Шаг 2: Определим линейную часть и критерий Попова**
```python
# Создадим линейную часть W(s) = 1 / ((s+1)(s^2 + s + 1))
num = [1]  # Числитель: 1
den = np.polyconv([1, 1], [1, 1, 1])  # Знаменатель: (s+1)(s^2+s+1)
# den = [1, 2, 2, 1] 
sys = signal.TransferFunction(num, den)

# Рассчитаем АФХ линейной части
w, H = signal.freqresp(sys, omega=omega)
W_real = H.real
W_imag = H.imag

# Функция для проверки критерия Попова: F(ω) = Re[(1+jωq)W(jω)] + 1/k
def popov_criterion(W_real, W_imag, w, q, k):
    # (1 + jωq) * W(jω) = W_real - q*ω*W_imag + j*(...)
    # Нас интересует только вещественная часть:
    real_part = W_real - q * w * W_imag
    return real_part + 1/k
```

**Шаг 3: Проведем анализ и визуализацию**
```python
# Вычисляем значение критерия для всех частот
F_omega = popov_criterion(W_real, W_imag, w, q, k)

# Проверяем условие устойчивости
is_stable = np.all(F_omega > 0)
print(f"Система абсолютно устойчива в секторе [0, {k}]? {is_stable}")

# Строим график критерия Попова
plt.figure(figsize=(10, 6))
plt.plot(w, F_omega, linewidth=2, label=r'$F(\omega) = Re[(1+j\omega q)W(j\omega)] + 1/k$')
plt.axhline(0, color='r', linestyle='--', label='Нулевой уровень')
plt.xscale('log')  # Логарифмическая шкала по частоте
plt.xlabel('Частота ω, рад/с')
plt.ylabel('F(ω)')
plt.title(f'Проверка критерия Попова (q={q}, k={k}). Устойчива: {is_stable}')
plt.legend()
plt.grid(True, which="both", ls="-")
plt.ylim(bottom=-1, top=2)  # Масштабируем ось Y для наглядности
plt.show()

# ДОПОЛНИТЕЛЬНО: Строим годограф Попова и прямую Попова
Y_popov = w * W_imag  # Мнимая часть годографа Попова: V(ω) = ω * Im(W(jω))
X_popov = W_real      # Вещественная часть годографа Попова: U(ω) = Re(W(jω))

# Прямая Попова: x = -1/k + (1/q) * y => y = q*(x + 1/k)
# Создадим точки для построения прямой
x_line = np.linspace(np.min(X_popov), np.max(X_popov), 100)
y_line = q * (x_line + 1/k)  # Уравнение прямой

plt.figure(figsize=(10, 6))
plt.plot(X_popov, Y_popov, label='Годограф Попова G(ω)')
plt.plot(x_line, y_line, 'r--', label=f'Прямая Попова (q={q})')
plt.plot(-1/k, 0, 'ro', markersize=8, label=f'Точка (-1/k, 0) = ({-1/k:.2f}, 0)')
plt.xlabel('Re(G) = U(ω)')
plt.ylabel('Im(G) = ω * Im(W(jω))')
plt.title('Годограф Попова и прямая Попова')
plt.legend()
plt.grid(True)
plt.axis('equal')  # Важно: одинаковый масштаб осей
plt.show()
```

#### **5. Анализ результатов и подбор параметра `q`**

1.  **График `F(ω)`:** Если вся кривая лежит выше нулевой горизонтальной линии (как в нашем примере при `q=0.8`), условие выполнено. Система абсолютно устойчива.
2.  **Годограф Попова:** Годограф должен целиком лежать справа от прямой Попова. Точка `(-0.5, 0)` — это `(-1/k, 0)` для `k=2`.
3.  **Подбор `q`:** Если условие не выполняется (например, при `q=0`), нужно изменить параметр `q` (часто помогает его увеличение). Суть критерия — в возможности *подобрать* такой параметр `q`, при котором условие выполняется.
    ```python
    # Пример подбора q
    for q_test in [0.0, 0.3, 0.6, 0.9]:
        F_omega_test = popov_criterion(W_real, W_imag, w, q_test, k)
        is_stable_test = np.all(F_omega_test > 0)
        print(f"При q={q_test:.1f} система устойчива? {is_stable_test}")
    ```

#### **6. Важные замечания из в учебника Ким**

*   **Для нейтральных систем:** Если линейная часть имеет полюса на мнимой оси (нейтрально устойчива), критерий все равно применим, но требует модификации: неравенство должно быть *нестрогим* (`≥ 0`), а остальные полюса — строго в ЛПП.
*   **Консерватизм критерия:** Критерий Попова является *достаточным*. Если условие выполняется — система устойчива точно. Если не выполняется — система *может* быть устойчивой (критерий "не видит" эту устойчивость), либо неустойчивой. Это плата за общность.
*   **Сравнение с круговым критерием:** Критерий Попова обычно *менее консервативен*, чем круговой критерий, т.е. он "видит" устойчивость для более широкого сектора `k`.

Этот подробный разбор и код дают вам полный инструментарий для моделирования и проверки критерия Попова для любых заданных `W(s)` и `k`, как в примерах из учебника Д.П. Кима.
